# Java内存模型的基础

本篇记录第三章Java内存模型的第一部分内容。

## 并发编程模型的两个关键问题

线程之间如何通信和线程之间如何同步

   1. 共享内存

        共享程序的公共状态，隐式通信。

        程序员必须显式指定某个方法/代码需要在线程之间互斥执行，显式同步。

   2. 消息传递

        没有公共状态，通过发送消息进行显式通信。

        消息发送总是在消息接收之前，因此为隐式同步。

Java并发采用第一种，即共享内存模型。

## Java内存模型的抽象结构

1. 线程共享内存

    堆内存，其中存有实例域，静态域和数组元素。

    JVM中的线程共享部分：Java堆，方法区。

2. 线程私有内存

    栈内存，包括局部变量，方法处理器参数，异常处理器参数。

    JVM中的线程隔离部分：虚拟机栈，本地方法栈，程序计数器。

3. JMM中定义的抽象关系

    > 线程之间的共享变量存储于主内存中，每个线程都有一个私有的本地内存。
    >
    >本地内存是抽象概念，现实中是涵盖了缓存，写缓存区，寄存器以及其他的硬件和编译器优化。
4. 线程A与线程B的通信示例

   (1) 线程A把本地内存A中更新过的共享变量刷新到主内存中。

   (2) 线程B到主内存中去读取线程A之前已更新过的共享变量。

    具体流程可参考下图。

![avatar](/pic/ThreadCrossCommunn.png)

